const Session = require('./../../db/session')

// api calls
const GetSynchronization = require('./../api/getSynchronization')

class SyncConflict {
  constructor (hostname, synchronizationId) {
    this.hostname = hostname
    this.synchronizationId = synchronizationId
  }

  async run () {
    const sesh = new Session()
    const token = sesh.token()
    const synchronizationId = this.synchronizationId

    const data = await new GetSynchronization(this.hostname, token, synchronizationId).run()

    const conflictedFiles = []
    for (const file of data.files) {
      if (file.status === 'conflicted') {
        conflictedFiles.push({
          filepath: file.filepath,
          diffAnsi: file.diff_ansi
        })
      }
    }

    return {
      id: data.id,
      conflictedFiles
    }
  }
}

module.exports = SyncConflict
