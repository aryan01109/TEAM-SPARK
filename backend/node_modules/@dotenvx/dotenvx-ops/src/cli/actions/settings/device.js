const { logger } = require('@dotenvx/dotenvx')

const Session = require('./../../../db/session')
const smartMask = require('./../../../lib/helpers/smartMask')

function device () {
  const options = this.opts()

  try {
    const sesh = new Session()
    const devicePublicKey = sesh.devicePublicKey()
    if (devicePublicKey && devicePublicKey.length > 1) {
      process.stdout.write(smartMask(devicePublicKey, options.unmask, 11))
    } else {
      logger.error('missing device. Try generating one with [dotenvx-ops login].')
      process.exit(1)
    }
  } catch (error) {
    logger.error(error.message)
    process.exit(1)
  }
}

module.exports = device
