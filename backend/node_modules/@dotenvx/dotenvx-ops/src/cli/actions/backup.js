// const fs = require('fs')
// const crypto = require('crypto')

const { logger } = require('@dotenvx/dotenvx')

const { createSpinner } = require('./../../lib/helpers/createSpinner')

const Backup = require('./../../lib/services/backup')

const spinner = createSpinner('backing up')

async function backup () {
  // debug opts
  const options = this.opts()

  try {
    logger.debug(`options: ${JSON.stringify(options)}`)

    spinner.start()

    const {
      projectUsernameName,
      files
    } = await new Backup(options.hostname, options.force).run()
    logger.debug(`files: ${JSON.stringify(files)}`)

    // write output files
    // for (const file of files) {
    //   // const { filepath, src, sha } = file
    // }

    spinner.stop()

    logger.success(`âœ” backed up [${projectUsernameName}]`)
  } catch (error) {
    spinner.stop()
    if (error.message) {
      logger.error(error.message)
    } else {
      logger.error(error)
    }
    if (error.help) {
      logger.help(error.help)
    }
    if (error.stack) {
      logger.debug(error.stack)
    }

    process.exit(1)
  }
}

module.exports = backup
